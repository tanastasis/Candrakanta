<div id="postfix-block-{{ d.variant_id }}" class="mb-3">
  <div class="font-semibold mb-3">
    <span>{{ d.surface }}</span>
  </div>

  <!-- Кнопки из allowed_posts -->
  <div class="flex flex-wrap gap-2 mb-3">
    {% for p in d.allowed_posts %}
      <button class="px-2 py-1 border rounded"
              hx-post="/api/variant/{{ d.variant_id }}/with_postfix"
              hx-vals='js:{"post":"{{ p }}", "show_all": (document.body.dataset.showAllVariants==="1"?"1":"0")}'
              hx-target="#postfix-block-{{ d.variant_id }}"
              hx-swap="outerHTML">
        {{ d.labels[p] }}
      </button>
    {% endfor %}
  </div>

  {% if d.variants and d.variants|length > 0 %}
    <ul class="flex flex-wrap gap-2 mb-3">
      {% for v in d.variants %}
        <span class="variant-pill inline-flex items-center gap-1 px-2 py-1 rounded-full border hover:bg-gray-50 whitespace-nowrap"
              data-canonical="{{ '1' if v['is_canonical'] else '0' }}"
              style="display: {{ 'inline-flex' if (show_all=='1') or v['is_canonical'] else 'none' }};">
          <a href="#"
             hx-get="/api/variant/{{ v['variant_id'] }}/derivation"
             hx-target="#postfix-deriv-{{ d.variant_id }}"
             hx-swap="innerHTML"
             class="inline-flex items-center gap-1"
             title="{{ v['variant_id'] }}">
            {{ v['surface'] }}
          </a>
        </span>
      {% endfor %}
    </ul>
  {% else %}
    <div class="text-gray-500 mb-3">—</div>
  {% endif %}

  <div id="postfix-deriv-{{ d.variant_id }}" class="mt-3"
       {% if d.initial_variant_id %}
       hx-get="/api/variant/{{ d.initial_variant_id }}/derivation"
       hx-trigger="load"
       hx-target="this"
       hx-swap="innerHTML"
       {% endif %}>
  </div>
</div>